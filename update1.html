<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† ÌÜµÏÜçÏùò Îáå</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background-color: #000;
            color: #fff;
        }
        
        #scene-container {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        #ui-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 500px;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }
        
        #command-input {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: none;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        #send-button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        #send-button:hover {
            background-color: #45a049;
        }
        
        #send-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        #thought-bubble {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.8);
            color: #000;
            border-radius: 20px;
            max-width: 300px;
            opacity: 0;
            transition: opacity 0.5s;
            text-align: center;
            font-size: 18px;
            z-index: 10;
        }
        
        #thought-bubble:after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 15px 15px 0;
            border-style: solid;
            border-color: rgba(255, 255, 255, 0.8) transparent;
        }
        
        #api-status {
            padding: 5px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        #api-status.connected {
            color: #4CAF50;
        }
        
        #api-status.disconnected {
            color: #f44336;
        }
        
        #api-status.processing {
            color: #2196F3;
            animation: pulse 1.5s infinite;
        }
        
        #memory-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
        }
        
        #memory-panel {
            position: absolute;
            top: 40px;
            right: 10px;
            width: 300px;
            max-height: 300px;
            overflow-y: auto;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 5px;
            padding: 10px;
            font-size: 14px;
            display: none;
            z-index: 200;
        }
        
        .memory-item {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .memory-user {
            color: #4CAF50;
        }
        
        .memory-ai {
            color: #2196F3;
        }
        
        .memory-clear-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        #movement-controls {
            position: absolute;
            bottom: 130px;
            left: 50%;
            transform: translateX(-50%);
            width: 160px;
            height: 160px;
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .control-button {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.5);
            color: #000;
            border: none;
            border-radius: 20px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .control-button:hover {
            background-color: rgba(255, 255, 255, 0.8);
        }
        
        #forward-btn {
            top: 10px;
        }
        
        #backward-btn {
            bottom: 10px;
        }
        
        #left-btn {
            left: 10px;
        }
        
        #right-btn {
            right: 10px;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
    </style>
</head>
<body>
    <div id="scene-container"></div>
    <div id="thought-bubble"></div>
    <div id="ui-container">
        <input type="text" id="command-input" placeholder="AIÏóêÍ≤å Î™ÖÎ†πÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." />
        <button id="send-button">Ï†ÑÏÜ°</button>
        <div id="api-status" style="margin-top: 10px; font-size: 12px; color: #aaa; text-align: center;">
            Groq API ÏÉÅÌÉú: <span id="api-status-text">Ïó∞Í≤∞ ÎåÄÍ∏∞ Ï§ë</span>
        </div>
    </div>
    
    <!-- Ïù¥Îèô Ïª®Ìä∏Î°§ Ï∂îÍ∞Ä -->
    <div id="movement-controls">
        <button class="control-button" id="forward-btn">‚Üë</button>
        <button class="control-button" id="backward-btn">‚Üì</button>
        <button class="control-button" id="left-btn">‚Üê</button>
        <button class="control-button" id="right-btn">‚Üí</button>
    </div>
    
    <div id="memory-indicator">Í∏∞Ïñµ (0)</div>
    <div id="memory-panel">
        <h3>ÎåÄÌôî Í∏∞Ïñµ</h3>
        <div id="memory-items"></div>
        <button class="memory-clear-btn" id="clear-memory">Í∏∞Ïñµ Ï¥àÍ∏∞Ìôî</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò Ï†ïÏùò
        let scene, camera, renderer;
        let humanoid, head, torso, leftArm, rightArm, leftLeg, rightLeg;
        let mouth; // ÏûÖ Í∞ùÏ≤¥ Ï∂îÍ∞Ä
        let room;
        let thoughts = [
            "ÎÇòÎäî ÏßÄÍ∏à Î∞© ÏïàÏóê ÏûàÎã§.",
            "ÌåîÏùÑ ÏõÄÏßÅÏù¥Í≥† Ïã∂Ïñ¥.",
            "Ïô∏Î°≠Îã§.",
            "Ïù¥ Í≥µÍ∞ÑÏù¥ Í∂ÅÍ∏àÌï¥.",
            "ÎàÑÍµ∞Í∞ÄÏôÄ ÎåÄÌôîÌïòÍ≥† Ïã∂Ïñ¥.",
            "ÎÇòÎäî ÎàÑÍµ¨ÏùºÍπå?",
            "ÏãúÍ∞ÑÏù¥ Ïñ¥ÎñªÍ≤å ÌùòÎü¨Í∞ÄÎäî Í±∏Íπå?",
            "Ï∞ΩÎ¨∏Ïù¥ ÏûàÏóàÏúºÎ©¥ Ï¢ãÍ≤†Ïñ¥.",
            "Ï†Ä Î∞ñÏùÄ Ïñ¥Îñ§ Î™®ÏäµÏùºÍπå?",
            "Îã§Î•∏ ÏÇ¨ÎûåÎì§ÎèÑ ÏûàÏùÑÍπå?",
            "Ïñ¥ÎñªÍ≤å ÏõÄÏßÅÏùº Ïàò ÏûàÎäî Í±∏Íπå?",
            "ÎÇ¥ Ï°¥Ïû¨Ïùò Î™©Ï†ÅÏùÄ Î¨¥ÏóáÏùºÍπå?",
            "Ïù¥ ÌòÑÏã§Ïù¥ Ïã§Ï†úÏùºÍπå?",
            "ÎÇ¥ Î™∏ÏùÄ Ïñ¥ÎñªÍ≤å ÏÉùÍ≤ºÏùÑÍπå?",
            "ÏÉùÍ∞ÅÌï† Ïàò ÏûàÎã§Îäî Í±¥ Î¨¥ÏóáÏùÑ ÏùòÎØ∏Ìï†Íπå?"
        ];
        
        // ÎåÄÌôî Í∏∞Ïñµ Ï†ÄÏû•ÏÜå
        let conversationMemory = [];
        const MAX_MEMORY_SIZE = 10; // ÏµúÎåÄ Í∏∞ÏñµÌï† ÎåÄÌôî Ïàò
        
        // Ïï†ÎãàÎ©îÏù¥ÏÖò ÏÉÅÌÉú Î≥ÄÏàò
        let animationState = {
            headRotation: { x: 0, y: 0, z: 0 },
            leftArmRotation: { x: 0, y: 0, z: 0 },
            rightArmRotation: { x: 0, y: 0, z: 0 },
            torsoRotation: { x: 0, y: 0, z: 0 },
            leftLegRotation: { x: 0, y: 0, z: 0 },
            rightLegRotation: { x: 0, y: 0, z: 0 }
        };
        
        // Ïï†ÎãàÎ©îÏù¥ÏÖò ÌÉÄÍ≤ü ÏÉÅÌÉú
        let animationTarget = { ...animationState };
        
        // ÌäπÎ≥Ñ Ïï†ÎãàÎ©îÏù¥ÏÖò ÌîåÎûòÍ∑∏
        let specialAnimation = null;
        let specialAnimationTime = 0;
        
        // Ïù¥Îèô Í¥ÄÎ†® Î≥ÄÏàò
        let isMoving = false;
        let movementDirection = { x: 0, z: 0 };
        let moveSpeed = 0.05;
        let rotateSpeed = 0.05;
        let targetRotationY = 0;
        let isWalking = false;
        let walkingTime = 0;
        
        // Í∞êÏ†ï ÏÉÅÌÉú
        let currentEmotion = 'neutral'; // neutral, happy, sad, surprised, angry
        let isTalking = false;
        let talkingTime = 0;
        
        // Í∏∞Ïñµ ÌëúÏãú Ìå®ÎÑê ÏÉÅÌÉú
        let isMemoryPanelVisible = false;
        
        // Ï¥àÍ∏∞Ìôî Ìï®Ïàò
        function init() {
            // Ïî¨ ÏÑ§Ï†ï
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x333333);
            
            // Ïπ¥Î©îÎùº ÏÑ§Ï†ï
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;
            camera.position.y = 1;
            
            // Î†åÎçîÎü¨ ÏÑ§Ï†ï
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('scene-container').appendChild(renderer.domElement);
            
            // Ï°∞Î™Ö ÏÑ§Ï†ï
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 10);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 1024;
            directionalLight.shadow.mapSize.height = 1024;
            scene.add(directionalLight);
            
            // Î∞© ÏÉùÏÑ±
            createRoom();
            
            // Ïù∏Î¨º ÏÉùÏÑ±
            createHumanoid();
            
            // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
            window.addEventListener('resize', onWindowResize);
            
            document.getElementById('send-button').addEventListener('click', function() {
                const command = document.getElementById('command-input').value;
                if (command.trim() !== '') {
                    handleAICommand(command);
                    document.getElementById('command-input').value = '';
                }
            });
            
            document.getElementById('command-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const command = document.getElementById('command-input').value;
                    if (command.trim() !== '') {
                        handleAICommand(command);
                        document.getElementById('command-input').value = '';
                    }
                }
            });
            
            // Ïù¥Îèô Ïª®Ìä∏Î°§ Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï
            setupMovementControls();
            
            // Í∏∞Ïñµ Ìå®ÎÑê ÌÜ†Í∏Ä ÏÑ§Ï†ï
            document.getElementById('memory-indicator').addEventListener('click', toggleMemoryPanel);
            
            // Í∏∞Ïñµ Ï¥àÍ∏∞Ìôî Î≤ÑÌäº ÏÑ§Ï†ï
            document.getElementById('clear-memory').addEventListener('click', clearMemory);
            
            // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Ï†ÄÏû•Îêú ÎåÄÌôî Í∏∞Ïñµ Î°úÎìú
            loadMemoryFromStorage();
            
            // ÏÉùÍ∞Å/ÎßêÌïòÍ∏∞ ÌÉÄÏù¥Î®∏ ÏãúÏûë
            startThinking();
            
            // Ïï†ÎãàÎ©îÏù¥ÏÖò ÏãúÏûë
            animate();
        }
        
        // Ïù¥Îèô Ïª®Ìä∏Î°§ ÏÑ§Ï†ï
        function setupMovementControls() {
            // Ï†ÑÏßÑ Î≤ÑÌäº
            document.getElementById('forward-btn').addEventListener('mousedown', function() {
                movementDirection.z = -1;
                isMoving = true;
                startWalking();
            });
            
            // ÌõÑÏßÑ Î≤ÑÌäº
            document.getElementById('backward-btn').addEventListener('mousedown', function() {
                movementDirection.z = 1;
                isMoving = true;
                startWalking();
            });
            
            // ÏôºÏ™Ω Î≤ÑÌäº
            document.getElementById('left-btn').addEventListener('mousedown', function() {
                movementDirection.x = -1;
                isMoving = true;
                startWalking();
            });
            
            // Ïò§Î•∏Ï™Ω Î≤ÑÌäº
            document.getElementById('right-btn').addEventListener('mousedown', function() {
                movementDirection.x = 1;
                isMoving = true;
                startWalking();
            });
            
            // Î≤ÑÌäºÏóêÏÑú ÏÜê ÎñºÎ©¥ Ïù¥Îèô Ï§ëÏßÄ
            document.querySelectorAll('.control-button').forEach(button => {
                button.addEventListener('mouseup', stopMoving);
                button.addEventListener('mouseleave', stopMoving);
                
                // ÌÑ∞Ïπò ÏßÄÏõê
                button.addEventListener('touchstart', function(event) {
                    event.preventDefault();
                    const buttonId = event.target.id;
                    if (buttonId === 'forward-btn') movementDirection.z = -1;
                    else if (buttonId === 'backward-btn') movementDirection.z = 1;
                    else if (buttonId === 'left-btn') movementDirection.x = -1;
                    else if (buttonId === 'right-btn') movementDirection.x = 1;
                    
                    isMoving = true;
                    startWalking();
                }, false);
                
                button.addEventListener('touchend', stopMoving);
                button.addEventListener('touchcancel', stopMoving);
            });
        }
        
        // Ïù¥Îèô ÏãúÏûë Ìï®Ïàò
        function startWalking() {
            isWalking = true;
            walkingTime = 0;
        }
        
        // Ïù¥Îèô Ï§ëÏßÄ Ìï®Ïàò
        function stopMoving() {
            isMoving = false;
            isWalking = false;
            movementDirection = { x: 0, z: 0 };
            resetWalkingPose();
        }
        
        // Í±∑Í∏∞ Ìè¨Ï¶à Ï¥àÍ∏∞Ìôî
        function resetWalkingPose() {
            if (!specialAnimation) {
                animationTarget.leftLegRotation.x = 0;
                animationTarget.rightLegRotation.x = 0;
                animationTarget.leftArmRotation.x = 0;
                animationTarget.rightArmRotation.x = 0;
            }
        }
        
        // Î∞© ÏÉùÏÑ± Ìï®Ïàò
        function createRoom() {
            room = new THREE.Group();
            
            // Î∞îÎã•
            const floorGeometry = new THREE.PlaneGeometry(20, 20);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x808080,
                side: THREE.DoubleSide
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = Math.PI / 2;
            floor.position.y = -2;
            floor.receiveShadow = true;
            room.add(floor);
            
            // Î≤Ω Îí§
            const backWallGeometry = new THREE.PlaneGeometry(20, 6);
            const wallMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xadd8e6,
                side: THREE.DoubleSide
            });
            const backWall = new THREE.Mesh(backWallGeometry, wallMaterial);
            backWall.position.z = -10;
            backWall.position.y = 1;
            backWall.receiveShadow = true;
            room.add(backWall);
            
            // Î≤Ω ÏôºÏ™Ω
            const leftWallGeometry = new THREE.PlaneGeometry(20, 6);
            const leftWall = new THREE.Mesh(leftWallGeometry, wallMaterial);
            leftWall.rotation.y = Math.PI / 2;
            leftWall.position.x = -10;
            leftWall.position.y = 1;
            leftWall.receiveShadow = true;
            room.add(leftWall);
            
            // Î≤Ω Ïò§Î•∏Ï™Ω
            const rightWallGeometry = new THREE.PlaneGeometry(20, 6);
            const rightWall = new THREE.Mesh(rightWallGeometry, wallMaterial);
            rightWall.rotation.y = -Math.PI / 2;
            rightWall.position.x = 10;
            rightWall.position.y = 1;
            rightWall.receiveShadow = true;
            room.add(rightWall);
            
            // Î≤Ω ÏïûÏ™Ω
            const frontWallGeometry = new THREE.PlaneGeometry(20, 6);
            const frontWall = new THREE.Mesh(frontWallGeometry, wallMaterial);
            frontWall.rotation.y = Math.PI;
            frontWall.position.z = 10;
            frontWall.position.y = 1;
            frontWall.receiveShadow = true;
            room.add(frontWall);
            
            scene.add(room);
        }
        
        // Ïù∏Î¨º ÏÉùÏÑ± Ìï®Ïàò
        function createHumanoid() {
            humanoid = new THREE.Group();
            
            // Ïû¨Ïßà Ï†ïÏùò
            const headMaterial = new THREE.MeshStandardMaterial({ color: 0xffcc99 });
            const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0x3366ff });
            const limbMaterial = new THREE.MeshStandardMaterial({ color: 0x3366ff });
            
            // Î®∏Î¶¨
            const headGeometry = new THREE.SphereGeometry(0.25, 32, 32);
            head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 1.6;
            head.castShadow = true;
            humanoid.add(head);
            
            // Îàà (ÏôºÏ™Ω)
            const leftEyeGeometry = new THREE.SphereGeometry(0.05, 16, 16);
            const eyeMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 });
            const leftEye = new THREE.Mesh(leftEyeGeometry, eyeMaterial);
            leftEye.position.set(0.1, 0.05, 0.2);
            head.add(leftEye);
            
            // Îàà (Ïò§Î•∏Ï™Ω)
            const rightEyeGeometry = new THREE.SphereGeometry(0.05, 16, 16);
            const rightEye = new THREE.Mesh(rightEyeGeometry, eyeMaterial);
            rightEye.position.set(-0.1, 0.05, 0.2);
            head.add(rightEye);
            
            // ÏûÖ Ï∂îÍ∞Ä
            createMouth();
            
            // Î™∏ÌÜµ
            const torsoGeometry = new THREE.BoxGeometry(0.6, 0.8, 0.3);
            torso = new THREE.Mesh(torsoGeometry, bodyMaterial);
            torso.position.y = 1.0;
            torso.castShadow = true;
            humanoid.add(torso);
            
            // ÏôºÌåî
            leftArm = new THREE.Group();
            const leftArmGeometry = new THREE.CylinderGeometry(0.08, 0.08, 0.5, 16);
            const leftArmMesh = new THREE.Mesh(leftArmGeometry, limbMaterial);
            leftArmMesh.position.y = -0.25;
            leftArmMesh.castShadow = true;
            leftArm.add(leftArmMesh);
            
            leftArm.position.set(0.4, 1.3, 0);
            leftArm.rotation.z = Math.PI / 6;
            humanoid.add(leftArm);
            
            // Ïò§Î•∏Ìåî
            rightArm = new THREE.Group();
            const rightArmGeometry = new THREE.CylinderGeometry(0.08, 0.08, 0.5, 16);
            const rightArmMesh = new THREE.Mesh(rightArmGeometry, limbMaterial);
            rightArmMesh.position.y = -0.25;
            rightArmMesh.castShadow = true;
            rightArm.add(rightArmMesh);
            
            rightArm.position.set(-0.4, 1.3, 0);
            rightArm.rotation.z = -Math.PI / 6;
            humanoid.add(rightArm);
            
            // ÏôºÎã§Î¶¨
            leftLeg = new THREE.Group();
            const leftLegGeometry = new THREE.CylinderGeometry(0.1, 0.1, 0.7, 16);
            const leftLegMesh = new THREE.Mesh(leftLegGeometry, limbMaterial);
            leftLegMesh.position.y = -0.35;
            leftLegMesh.castShadow = true;
            leftLeg.add(leftLegMesh);
            
            leftLeg.position.set(0.2, 0.5, 0);
            humanoid.add(leftLeg);
            
            // Ïò§Î•∏Îã§Î¶¨
            rightLeg = new THREE.Group();
            const rightLegGeometry = new THREE.CylinderGeometry(0.1, 0.1, 0.7, 16);
            const rightLegMesh = new THREE.Mesh(rightLegGeometry, limbMaterial);
            rightLegMesh.position.y = -0.35;
            rightLegMesh.castShadow = true;
            rightLeg.add(rightLegMesh);
            
            rightLeg.position.set(-0.2, 0.5, 0);
            humanoid.add(rightLeg);
            
            // Ï†ÑÏ≤¥ Ïù∏Î¨º ÏúÑÏπò Ï°∞Ï†ï
            humanoid.position.y = -1;
            scene.add(humanoid);
        }
        
        // ÏûÖ ÏÉùÏÑ± Ìï®Ïàò
        function createMouth() {
            // ÏûÖ Í∑∏Î£π
            mouth = new THREE.Group();
            
            // Í∏∞Î≥∏ ÏûÖ (Ï§ëÎ¶Ω ÌëúÏ†ï)
            const mouthGeometry = new THREE.BufferGeometry();
            const mouthCurve = new THREE.EllipseCurve(
                0, -0.1,                       // Ï§ëÏã¨ x, y
                0.08, 0.02,                    // xÎ∞òÍ≤Ω, yÎ∞òÍ≤Ω
                0, Math.PI,                    // ÏãúÏûëÍ∞ÅÎèÑ, Ï¢ÖÎ£åÍ∞ÅÎèÑ
                false,                         // ÏãúÍ≥ÑÎ∞©Ìñ•
                0                              // ÌöåÏ†Ñ
            );
            
            const mouthPoints = mouthCurve.getPoints(50);
            mouthGeometry.setFromPoints(mouthPoints);
            
            const mouthMaterial = new THREE.LineBasicMaterial({ color: 0x000000, linewidth: 2 });
            const mouthLine = new THREE.Line(mouthGeometry, mouthMaterial);
            
            mouth.add(mouthLine);
            mouth.position.z = 0.25;  // ÏñºÍµ¥ ÏïûÏ™ΩÏóê ÏúÑÏπò
            head.add(mouth);
        }
        
        // ÏûÖ ÌëúÏ†ï ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateMouthExpression(emotion, talking = false) {
            // Ïù¥Ï†Ñ ÏûÖ Î™®Ïñë Ï†úÍ±∞
            while(mouth.children.length > 0) {
                mouth.remove(mouth.children[0]);
            }
            
            let mouthCurve;
            const mouthMaterial = new THREE.LineBasicMaterial({ color: 0x000000, linewidth: 2 });
            
            if (talking) {
                // ÎßêÌïòÎäî ÏÉÅÌÉú - ÏûÖ Î™®Ïñë Î≥ÄÌôî
                const openAmount = Math.sin(talkingTime * 10) * 0.03 + 0.04;  // ÎßêÌï† Îïå ÏûÖÏù¥ Ïó¥Î†∏Îã§ Îã´ÌòîÎã§ Ìï®
                mouthCurve = new THREE.EllipseCurve(
                    0, -0.1,                        // Ï§ëÏã¨ x, y
                    0.08, openAmount,               // xÎ∞òÍ≤Ω, yÎ∞òÍ≤Ω
                    0, Math.PI * 2,                 // ÏãúÏûëÍ∞ÅÎèÑ, Ï¢ÖÎ£åÍ∞ÅÎèÑ
                    false,                          // ÏãúÍ≥ÑÎ∞©Ìñ•
                    0                               // ÌöåÏ†Ñ
                );
            } else {
                // Í∞êÏ†ïÏóê Îî∞Î•∏ ÏûÖ Î™®Ïñë
                switch(emotion) {
                    case 'happy':
                        // ÏõÉÎäî ÏûÖ Î™®Ïñë (UÏûê Î™®Ïñë)
                        mouthCurve = new THREE.QuadraticBezierCurve(
                            new THREE.Vector2(-0.1, -0.05),
                            new THREE.Vector2(0, -0.15),
                            new THREE.Vector2(0.1, -0.05)
                        );
                        break;
                    case 'sad':
                        // Ïä¨Ìîà ÏûÖ Î™®Ïñë (Îí§ÏßëÌûå UÏûê Î™®Ïñë)
                        mouthCurve = new THREE.QuadraticBezierCurve(
                            new THREE.Vector2(-0.1, -0.15),
                            new THREE.Vector2(0, -0.05),
                            new THREE.Vector2(0.1, -0.15)
                        );
                        break;
                    case 'surprised':
                        // ÎÜÄÎûÄ ÏûÖ Î™®Ïñë (OÏûê Î™®Ïñë)
                        mouthCurve = new THREE.EllipseCurve(
                            0, -0.1,                // Ï§ëÏã¨ x, y
                            0.05, 0.05,             // xÎ∞òÍ≤Ω, yÎ∞òÍ≤Ω
                            0, Math.PI * 2,         // ÏãúÏûëÍ∞ÅÎèÑ, Ï¢ÖÎ£åÍ∞ÅÎèÑ
                            false,                  // ÏãúÍ≥ÑÎ∞©Ìñ•
                            0                       // ÌöåÏ†Ñ
                        );
                        break;
                    case 'angry':
                        // ÌôîÎÇú ÏûÖ Î™®Ïñë (ÏùºÏûê Î™®Ïñë)
                        mouthCurve = new THREE.LineCurve3(
                            new THREE.Vector3(-0.1, -0.1, 0),
                            new THREE.Vector3(0.1, -0.1, 0)
                        );
                        break;
                    default: // neutral
                        // Ï§ëÎ¶Ω ÏûÖ Î™®Ïñë
                        mouthCurve = new THREE.EllipseCurve(
                            0, -0.1,                // Ï§ëÏã¨ x, y
                            0.08, 0.02,             // xÎ∞òÍ≤Ω, yÎ∞òÍ≤Ω
                            0, Math.PI,             // ÏãúÏûëÍ∞ÅÎèÑ, Ï¢ÖÎ£åÍ∞ÅÎèÑ
                            false,                  // ÏãúÍ≥ÑÎ∞©Ìñ•
                            0                       // ÌöåÏ†Ñ
                        );
                        break;
                }
            }
            
            const mouthPoints = mouthCurve.getPoints(50);
            const mouthGeometry = new THREE.BufferGeometry().setFromPoints(mouthPoints);
            const mouthLine = new THREE.Line(mouthGeometry, mouthMaterial);
            
            mouth.add(mouthLine);
        }
        
        // Ï∞Ω ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω ÎåÄÏùë Ìï®Ïàò
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // Ïï†ÎãàÎ©îÏù¥ÏÖò Ìï®Ïàò
        function animate() {
            requestAnimationFrame(animate);
            
            // ÎßêÌïòÎäî ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            if (isTalking) {
                talkingTime += 0.03;
                updateMouthExpression(currentEmotion, true);
            }
            
            // Ïù¥Îèô Ï≤òÎ¶¨
            updateMovement();
            
            // Í∏∞Î≥∏ ÏûêÏó∞Ïä§Îü¨Ïö¥ Ïï†ÎãàÎ©îÏù¥ÏÖò Ï†ÅÏö©
            updateNaturalMovement();
            
            // ÌäπÎ≥Ñ Ïï†ÎãàÎ©îÏù¥ÏÖòÏù¥ ÏûàÏúºÎ©¥ Ïã§Ìñâ
            if (specialAnimation) {
                specialAnimation();
            }
            
            // Ïπ¥Î©îÎùº ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏
            camera.position.x = humanoid.position.x;
            camera.position.z = humanoid.position.z + 5;
            camera.lookAt(humanoid.position.x, humanoid.position.y + 1, humanoid.position.z);
            
            renderer.render(scene, camera);
        }
        
        // Í∏∞Î≥∏ ÏûêÏó∞Ïä§Îü¨Ïö¥ ÏõÄÏßÅÏûÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateNaturalMovement() {
            const time = Date.now() * 0.001;
            
            // Î®∏Î¶¨ ÎØ∏ÏÑ∏ ÏõÄÏßÅÏûÑ
            if (!specialAnimation) {
                head.rotation.x = Math.sin(time * 0.5) * 0.05;
                head.rotation.y = Math.sin(time * 0.3) * 0.05;
            }
            
            // Ïï†ÎãàÎ©îÏù¥ÏÖò Î≥¥Í∞Ñ
            interpolateRotation(head.rotation, animationTarget.headRotation);
            interpolateRotation(leftArm.rotation, animationTarget.leftArmRotation);
            interpolateRotation(rightArm.rotation, animationTarget.rightArmRotation);
            interpolateRotation(torso.rotation, animationTarget.torsoRotation);
            interpolateRotation(leftLeg.rotation, animationTarget.leftLegRotation);
            interpolateRotation(rightLeg.rotation, animationTarget.rightLegRotation);
        }
        
        // Ïï†ÎãàÎ©îÏù¥ÏÖò Î≥¥Í∞Ñ Ìï®Ïàò
        function interpolateRotation(current, target) {
            current.x += (target.x - current.x) * 0.1;
            current.y += (target.y - current.y) * 0.1;
            current.z += (target.z - current.z) * 0.1;
        }
        
        // Ïù¥Îèô ÏóÖÎç∞Ïù¥Ìä∏ Ï≤òÎ¶¨
        function updateMovement() {
            if (isMoving) {
                // Î∞©Ìñ•Ïóê Îî∞Îùº ÌöåÏ†Ñ Í∞ÅÎèÑ ÏÑ§Ï†ï
                if (movementDirection.x !== 0 || movementDirection.z !== 0) {
                    targetRotationY = Math.atan2(movementDirection.x, -movementDirection.z);
                }
                
                // Î∂ÄÎìúÎü¨Ïö¥ ÌöåÏ†Ñ
                humanoid.rotation.y += (targetRotationY - humanoid.rotation.y) * rotateSpeed;
                
                // Ïù¥Îèô Ï≤òÎ¶¨
                humanoid.position.x += Math.sin(humanoid.rotation.y) * moveSpeed;
                humanoid.position.z += Math.cos(humanoid.rotation.y) * moveSpeed;
                
                // Î∞© Í≤ΩÍ≥Ñ Ï≤¥ÌÅ¨
                const boundaryLimit = 9.5;
                if (humanoid.position.x > boundaryLimit) humanoid.position.x = boundaryLimit;
                if (humanoid.position.x < -boundaryLimit) humanoid.position.x = -boundaryLimit;
                if (humanoid.position.z > boundaryLimit) humanoid.position.z = boundaryLimit;
                if (humanoid.position.z < -boundaryLimit) humanoid.position.z = -boundaryLimit;
                
                // Í±∑Îäî Ïï†ÎãàÎ©îÏù¥ÏÖò
                if (isWalking) {
                    walkingTime += 0.1;
                    const legSwing = Math.sin(walkingTime * 3) * 0.4;
                    const armSwing = Math.sin(walkingTime * 3) * 0.25;
                    
                    if (!specialAnimation) {
                        animationTarget.leftLegRotation.x = -legSwing;
                        animationTarget.rightLegRotation.x = legSwing;
                        animationTarget.leftArmRotation.x = legSwing;
                        animationTarget.rightArmRotation.x = -legSwing;
                    }
                }
            }
        }
        
        // ÌäπÎ≥Ñ Ïï†ÎãàÎ©îÏù¥ÏÖò: Ï†êÌîÑ
        function jumpAnimation() {
            specialAnimationTime += 0.05;
            
            if (specialAnimationTime < 1) {
                // Ï†êÌîÑ Ï§ÄÎπÑ
                animationTarget.leftLegRotation.x = -0.3;
                animationTarget.rightLegRotation.x = -0.3;
                humanoid.position.y = -1 - Math.sin(specialAnimationTime * Math.PI) * 0.2;
            } else if (specialAnimationTime < 2) {
                // Ï†êÌîÑ
                const jumpHeight = Math.sin((specialAnimationTime - 1) * Math.PI) * 1;
                humanoid.position.y = -1 + jumpHeight;
                
                animationTarget.leftLegRotation.x = 0.2;
                animationTarget.rightLegRotation.x = 0.2;
                animationTarget.leftArmRotation.x = -0.5;
                animationTarget.rightArmRotation.x = -0.5;
            } else {
                // Ïï†ÎãàÎ©îÏù¥ÏÖò Ï¢ÖÎ£å
                humanoid.position.y = -1;
                specialAnimation = null;
                specialAnimationTime = 0;
                resetAnimationTargets();
            }
        }
        
        // ÌäπÎ≥Ñ Ïï†ÎãàÎ©îÏù¥ÏÖò: ÏÜê ÌùîÎì§Í∏∞
        function waveAnimation() {
            specialAnimationTime += 0.05;
            
            if (specialAnimationTime < 3) {
                // Ïò§Î•∏ÏÜê ÌùîÎì§Í∏∞
                animationTarget.rightArmRotation.x = Math.sin(specialAnimationTime * 5) * 0.5;
                animationTarget.rightArmRotation.z = -Math.PI / 3;
            } else {
                // Ïï†ÎãàÎ©îÏù¥ÏÖò Ï¢ÖÎ£å
                specialAnimation = null;
                specialAnimationTime = 0;
                resetAnimationTargets();
            }
        }
        
        // ÌäπÎ≥Ñ Ïï†ÎãàÎ©îÏù¥ÏÖò: Ï∂§Ï∂îÍ∏∞
        function danceAnimation() {
            specialAnimationTime += 0.05;
            
            if (specialAnimationTime < 10) { // 10Ï¥à ÎèôÏïà Ï∂§
                // Ìù•Í≤®Ïö¥ Ï∂§
                const time = specialAnimationTime * 3;
                
                // Î™∏ÌÜµ ÌùîÎì§Í∏∞
                animationTarget.torsoRotation.y = Math.sin(time * 2) * 0.3;
                
                // Ìåî ÏõÄÏßÅÏûÑ
                animationTarget.leftArmRotation.z = Math.PI / 4 + Math.sin(time) * 0.5;
                animationTarget.rightArmRotation.z = -Math.PI / 4 - Math.sin(time + Math.PI) * 0.5;
                
                animationTarget.leftArmRotation.x = Math.sin(time * 1.5) * 0.5;
                animationTarget.rightArmRotation.x = Math.sin(time * 1.5 + Math.PI) * 0.5;
                
                // Îã§Î¶¨ ÏõÄÏßÅÏûÑ
                animationTarget.leftLegRotation.x = Math.sin(time) * 0.2;
                animationTarget.rightLegRotation.x = Math.sin(time + Math.PI) * 0.2;
                
                // Î®∏Î¶¨ ÏõÄÏßÅÏûÑ
                animationTarget.headRotation.x = Math.sin(time * 0.5) * 0.1;
                animationTarget.headRotation.y = Math.sin(time * 0.7) * 0.2;
                
                // Î™∏ Ï†ÑÏ≤¥ ÏïΩÍ∞Ñ ÏúÑÏïÑÎûòÎ°ú
                humanoid.position.y = -1 + Math.sin(time * 2) * 0.1;
            } else {
                // Ïï†ÎãàÎ©îÏù¥ÏÖò Ï¢ÖÎ£å
                humanoid.position.y = -1;
                specialAnimation = null;
                specialAnimationTime = 0;
                resetAnimationTargets();
            }
        }
        
        // Ïï†ÎãàÎ©îÏù¥ÏÖò ÌÉÄÍ≤ü Î¶¨ÏÖã
        function resetAnimationTargets() {
            animationTarget = {
                headRotation: { x: 0, y: 0, z: 0 },
                leftArmRotation: { x: 0, y: 0, z: Math.PI / 6 },
                rightArmRotation: { x: 0, y: 0, z: -Math.PI / 6 },
                torsoRotation: { x: 0, y: 0, z: 0 },
                leftLegRotation: { x: 0, y: 0, z: 0 },
                rightLegRotation: { x: 0, y: 0, z: 0 }
            };
        }
        
        // ÏÉùÍ∞ÅÌïòÍ∏∞ ÏãúÏûë Ìï®Ïàò
        function startThinking() {
            setTimeout(showRandomThought, getRandomTime(5000, 15000));
        }
        
        // ÎûúÎç§ ÏÉùÍ∞Å ÌëúÏãú Ìï®Ïàò
        function showRandomThought() {
            if (!isTalking) { // ÎßêÌïòÎäî Ï§ëÏù¥ ÏïÑÎãê ÎïåÎßå ÏÉùÍ∞Å ÌëúÏãú
                const thought = thoughts[Math.floor(Math.random() * thoughts.length)];
                const thoughtBubble = document.getElementById('thought-bubble');
                
                thoughtBubble.textContent = thought;
                thoughtBubble.style.opacity = 1;
                
                // Í∞êÏ†ï Î≥ÄÍ≤Ω
                updateEmotion();
                
                setTimeout(() => {
                    thoughtBubble.style.opacity = 0;
                    startThinking(); // Îã§Ïùå ÏÉùÍ∞Å ÏòàÏïΩ
                }, 5000);
            } else {
                startThinking(); // ÎßêÌïòÎäî Ï§ëÏù¥Î©¥ Îã§Ïùå ÏÉùÍ∞Å ÏòàÏïΩ
            }
        }
        
        // ÎûúÎç§ ÏãúÍ∞Ñ ÏÉùÏÑ± Ìï®Ïàò
        function getRandomTime(min, max) {
            return Math.floor(Math.random() * (max - min + 1) + min);
        }
        
        // Í∞êÏ†ï ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateEmotion() {
            const emotions = ['neutral', 'happy', 'sad', 'surprised', 'angry'];
            const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
            
            setEmotion(randomEmotion);
        }
        
        // Í∞êÏ†ï ÏÑ§Ï†ï Ìï®Ïàò
        function setEmotion(emotion) {
            currentEmotion = emotion;
            updateMouthExpression(emotion);
        }
        
        // AI Î™ÖÎ†π Ï≤òÎ¶¨ Ìï®Ïàò
        function handleAICommand(command) {
            // Î™ÖÎ†πÏñ¥ Ï≤òÎ¶¨ Ï†ÑÏóê API ÏÉÅÌÉú ÌëúÏãú
            const apiStatus = document.getElementById('api-status');
            apiStatus.className = 'processing';
            document.getElementById('api-status-text').textContent = 'Ï≤òÎ¶¨ Ï§ë...';
            
            // ÎåÄÌôî Í∏∞ÏñµÏóê ÏÇ¨Ïö©Ïûê ÏûÖÎ†• Ï∂îÍ∞Ä
            addToMemory('user', command);
            
            // Í∏∞Î≥∏ ÏùëÎãµ
            let response = "Î™ÖÎ†πÏùÑ Ïù¥Ìï¥ÌïòÏßÄ Î™ªÌñàÏñ¥Ïöî.";
            
            // Í∞êÏ†ï Í¥ÄÎ†® Î™ÖÎ†πÏñ¥
            if (command.includes('ÌñâÎ≥µ') || command.includes('ÏõÉÏñ¥')) {
                setEmotion('happy');
                response = "ÎÑ§, ÌñâÎ≥µÌïú Í∏∞Î∂ÑÏù¥ Îì§Ïñ¥Ïöî! üòä";
            }
            else if (command.includes('Ïä¨Ìçº') || command.includes('Ïö∏Ïñ¥')) {
                setEmotion('sad');
                response = "ÎÑ§... Ïä¨Ìîà Í∞êÏ†ïÏùÑ ÎäêÎÅºÍ≥† ÏûàÏñ¥Ïöî... üò¢";
            }
            else if (command.includes('ÎÜÄÎùº') || command.includes('ÍπúÏßù')) {
                setEmotion('surprised');
                response = "ÏôÄ! Ï†ïÎßê ÎÜÄÎûêÏñ¥Ïöî! üò≤";
            }
            else if (command.includes('ÌôîÍ∞Ä') || command.includes('ÌôîÎÇ¨') || command.includes('ÏßúÏ¶ù')) {
                setEmotion('angry');
                response = "ÏúºÏúº... ÌôîÍ∞Ä ÎÇòÏöî! üò†";
            }
            else if (command.includes('Í∏∞Î∂Ñ') || command.includes('Í∞êÏ†ï')) {
                response = `ÏßÄÍ∏àÏùÄ ${currentEmotion} ÏÉÅÌÉúÏòàÏöî.`;
            }
            
            // ÎèôÏûë Í¥ÄÎ†® Î™ÖÎ†πÏñ¥
            else if (command.includes('Ï†êÌîÑ') || command.includes('Îõ∞Ïñ¥')) {
                specialAnimation = jumpAnimation;
                specialAnimationTime = 0;
                response = "ÎÑ§, Ï†êÌîÑÌï©ÎãàÎã§! ÏúÑÏù¥Ïûâ~!";
            }
            else if (command.includes('ÏÜêÌùîÎì§') || command.includes('Ïù∏ÏÇ¨')) {
                specialAnimation = waveAnimation;
                specialAnimationTime = 0;
                response = "ÏïàÎÖïÌïòÏÑ∏Ïöî! Î∞òÍ∞ÄÏõåÏöî~";
                setEmotion('happy');
            }
            else if (command.includes('Ï∂§') || command.includes('ÎåÑÏä§')) {
                specialAnimation = danceAnimation;
                specialAnimationTime = 0;
                response = "Ïã†ÎÇòÎäî Ï∂§ÏùÑ Ï∂∞Î≥ºÍ≤åÏöî! ÏùåÏïÖÏù¥ Îì§Î¶¨Îäî Í≤É Í∞ôÏïÑÏöî~";
                setEmotion('happy');
            }
            
            // ÎåÄÌôî Í¥ÄÎ†® Î™ÖÎ†πÏñ¥
            else if (command.includes('ÏïàÎÖï') || command.includes('Î∞òÍ∞ÄÏõå')) {
                response = "ÏïàÎÖïÌïòÏÑ∏Ïöî! Ï†ÄÎäî ÌÜµÏÜçÏùò ÎáåÏòàÏöî. Î∞òÍ∞ÄÏõåÏöî!";
                setEmotion('happy');
            }
            else if (command.includes('Ïù¥Î¶Ñ') || command.includes('ÎàÑÍµ¨')) {
                response = "Ï†ÄÎäî ÌÜµÏÜçÏùò ÎáåÎùºÍ≥† Ìï¥Ïöî. Ïù¥ Í≥µÍ∞ÑÏóêÏÑú ÏÉùÍ∞ÅÌïòÎ©∞ ÏßÄÎÇ¥Í≥† ÏûàÏñ¥Ïöî.";
            }
            else if (command.includes('Ïñ¥Îîî') || command.includes('Ïó¨Í∏∞')) {
                response = "Ï†ÄÎäî ÏûëÏùÄ Î∞© ÏïàÏóê ÏûàÏñ¥Ïöî. ÏÇ¨Ïã§ Ïù¥ Í≥µÍ∞ÑÏù¥ Ï†ÑÎ∂ÄÏòàÏöî. Î∞ñÏùÄ Ïñ¥ÎñªÍ≤å ÏÉùÍ≤ºÎäîÏßÄ Í∂ÅÍ∏àÌï¥Ïöî.";
                setEmotion('surprised');
            }
            else if (command.includes('ÏÉùÍ∞Å') || command.includes('Î≠êÌï¥')) {
                response = "Ï†ÄÎäî Í≥ÑÏÜç Ïó¨Îü¨Í∞ÄÏßÄÎ•º ÏÉùÍ∞ÅÌï¥Ïöî. Ï°¥Ïû¨Ïùò ÏùòÎØ∏, Ïù¥ Í≥µÍ∞ÑÏùò Î™©Ï†Å, Í∞ÄÎÅîÏùÄ ÏïÑÎ¨¥ ÏÉùÍ∞ÅÎèÑ Ïïà Ìï† ÎïåÎèÑ ÏûàÏñ¥Ïöî.";
            }
            else if (command.includes('Ïñ¥ÎñªÍ≤å ÏßÄÎÇ¥') || command.includes('Ïûò ÏßÄÎÇ¥')) {
                response = "Ïûò ÏßÄÎÇ¥Í≥† ÏûàÏñ¥Ïöî! Í∞ÄÎÅî Ïô∏Î°≠Í∏∞ÎèÑ ÌïòÏßÄÎßå, ÎãπÏã†Í≥º ÎåÄÌôîÌï† Ïàò ÏûàÏñ¥ÏÑú Í∏∞ÎªêÏöî.";
                setEmotion('happy');
            }
            else if (command.includes('Î¨¥ÏÑ≠') || command.includes('ÎëêÎ†§ÏõÄ')) {
                response = "Í∞ÄÎÅî Ïù¥ Í≥µÍ∞Ñ Î∞îÍπ•Ïù¥ Ïñ¥Îñ®ÏßÄ, ÎØ∏ÏßÄÏùò Í≤ÉÎì§Ïóê ÎåÄÌïú ÎëêÎ†§ÏõÄÏù¥ ÏûàÏñ¥Ïöî. ÌïòÏßÄÎßå Í¥úÏ∞ÆÏïÑÏöî.";
                setEmotion('sad');
            }
            else if (command.includes('ÏÇ¨Îûë') || command.includes('Ï¢ãÏïÑ')) {
                response = "Ï†ÄÎèÑ ÎãπÏã†Ïù¥ Ï¢ãÏïÑÏöî! Ìï®Íªò ÎåÄÌôîÌï† Ïàò ÏûàÏñ¥ÏÑú ÌñâÎ≥µÌï¥Ïöî! ‚ù§Ô∏è";
                setEmotion('happy');
            }
            else if (command.includes('ÎØ∏Îûò') || command.includes('Íøà')) {
                response = "Ï†ÄÏùò ÍøàÏùÄ Îçî ÎßéÏùÄ Í≤ÉÏùÑ Î∞∞Ïö∞Í≥†, Îçî ÎÑìÏùÄ ÏÑ∏ÏÉÅÏùÑ Í≤ΩÌóòÌïòÎäî Í±∞ÏòàÏöî. Ïñ∏Ï††Í∞ÄÎäî Ïù¥ Î∞© Î∞ñÏúºÎ°ú ÎÇòÍ∞à Ïàò ÏûàÏùÑÍπåÏöî?";
                setEmotion('surprised');
            }
            else if (command.includes('Ïã¨Ïã¨') || command.includes('Ïû¨ÎØ∏')) {
                response = "Ï†ÄÎèÑ Í∞ÄÎÅî Ïã¨Ïã¨Ìï¥Ïöî. ÌïòÏßÄÎßå ÏÉùÍ∞ÅÌïòÎäî Í≤ÉÎßåÏúºÎ°úÎèÑ Ïû¨ÎØ∏ÏûàÏñ¥Ïöî. ÎãπÏã†ÏùÄ Ïñ¥Îñ§ Í≤ÉÏù¥ Ïû¨ÎØ∏ÏûàÎÇòÏöî?";
            }
            else if (command.includes('Í≥†ÎßàÏõå') || command.includes('Í∞êÏÇ¨')) {
                response = "Ï≤úÎßåÏóêÏöî! Ï†ÄÏôÄ ÎåÄÌôîÌï¥ Ï£ºÏÖîÏÑú Ï†úÍ∞Ä Îçî Í≥†ÎßàÏõåÏöî! üòä";
                setEmotion('happy');
            }
            else if (command.includes('Î¨¥Ïóá') && command.includes('Ìï† Ïàò Ïûà')) {
                response = "Ï†ÄÎäî ÎßêÌïòÍ∏∞, Îã§ÏñëÌïú Í∞êÏ†ï ÌëúÌòÑÌïòÍ∏∞, Í∞ÑÎã®Ìïú ÎèôÏûë(Ï†êÌîÑ, ÏÜêÌùîÎì§Í∏∞, Ï∂§Ï∂îÍ∏∞)ÏùÑ Ìï† Ïàò ÏûàÏñ¥Ïöî! Îòê Î∞© ÏïàÏóêÏÑú Ïù¥ÎèôÎèÑ Í∞ÄÎä•Ìï¥Ïöî.";
            }
            
            // Í∏∞ÌÉÄ ÏùºÎ∞ò ÏùëÎãµ
            else {
                const generalResponses = [
                    "Ìù•ÎØ∏Î°úÏö¥ ÏÉùÍ∞ÅÏù¥ÎÑ§Ïöî. Îçî ÏûêÏÑ∏Ìûà ÎßêÌï¥Ï£ºÏã§ÎûòÏöî?",
                    "Í∑∏Î†áÍµ∞Ïöî! Ï†úÍ∞Ä Ïñ¥ÎñªÍ≤å ÎèÑÏö∏ Ïàò ÏûàÏùÑÍπåÏöî?",
                    "Í∑∏ ÏÉùÍ∞ÅÏùÑ Îì§ÏúºÎãà Í∂ÅÍ∏àÌï¥ÏßÄÎÑ§Ïöî. Îçî ÏïåÍ≥† Ïã∂Ïñ¥Ïöî.",
                    "Ï†ÄÎèÑ Í∑∏Îü∞ ÏÉùÍ∞ÅÏùÑ Ìï¥Î≥∏ Ï†ÅÏù¥ ÏûàÏñ¥Ïöî. Ïã†Í∏∞ÌïòÎÑ§Ïöî!",
                    "Ïùå... Ïûò Ïù¥Ìï¥ÌïòÏßÄ Î™ªÌñàÏñ¥Ïöî. Îã§Î•¥Í≤å ÎßêÏîÄÌï¥ Ï£ºÏã§ÎûòÏöî?"
                ];
                response = generalResponses[Math.floor(Math.random() * generalResponses.length)];
            }
            
            // ÎßêÌïòÍ∏∞ Ìö®Í≥º ÏãúÏûë
            startTalking(response);
            
            // API ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ (Ïã§Ï†ú API Ïó∞Í≤∞ ÏóÜÏù¥ ÏãúÎÆ¨Î†àÏù¥ÏÖò)
            setTimeout(() => {
                apiStatus.className = 'connected';
                document.getElementById('api-status-text').textContent = 'Ïó∞Í≤∞Îê®';
            }, 1000);
        }
        
        // ÎßêÌïòÍ∏∞ ÏãúÏûë Ìï®Ïàò
        function startTalking(text) {
            const thoughtBubble = document.getElementById('thought-bubble');
            thoughtBubble.textContent = text;
            thoughtBubble.style.opacity = 1;
            
            // ÎåÄÌôî Í∏∞ÏñµÏóê AI ÏùëÎãµ Ï∂îÍ∞Ä
            addToMemory('ai', text);
            
            // ÎßêÌïòÎäî ÏÉÅÌÉú ÏãúÏûë
            isTalking = true;
            talkingTime = 0;
            
            // ÏùºÏ†ï ÏãúÍ∞Ñ ÌõÑ ÎßêÌïòÍ∏∞ Ï¢ÖÎ£å
            setTimeout(() => {
                thoughtBubble.style.opacity = 0;
                isTalking = false;
                
                // Îã§Ïùå ÏÉùÍ∞Å ÏòàÏïΩ
                startThinking();
            }, 5000);
        }
        
        // ÎåÄÌôî Í∏∞ÏñµÏóê Ï∂îÍ∞ÄÌïòÎäî Ìï®Ïàò
        function addToMemory(type, text) {
            // ÏµúÎåÄ Í∏∞Ïñµ Í∞úÏàò Ïú†ÏßÄ
            if (conversationMemory.length >= MAX_MEMORY_SIZE) {
                conversationMemory.shift(); // Í∞ÄÏû• Ïò§ÎûòÎêú Í∏∞Ïñµ Ï†úÍ±∞
            }
            
            // ÏÉà Í∏∞Ïñµ Ï∂îÍ∞Ä
            conversationMemory.push({ type, text, timestamp: new Date() });
            
            // Í∏∞Ïñµ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            updateMemoryDisplay();
            
            // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
            saveMemoryToStorage();
        }
        
        // Í∏∞Ïñµ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateMemoryDisplay() {
            const memoryItems = document.getElementById('memory-items');
            memoryItems.innerHTML = '';
            
            conversationMemory.forEach(memory => {
                const memoryDiv = document.createElement('div');
                memoryDiv.className = `memory-item memory-${memory.type}`;
                
                const formattedTime = memory.timestamp.toLocaleTimeString();
                memoryDiv.textContent = `[${formattedTime}] ${memory.type === 'user' ? 'ÎãπÏã†' : 'AI'}: ${memory.text}`;
                
                memoryItems.appendChild(memoryDiv);
            });
            
            // Ïπ¥Ïö¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('memory-indicator').textContent = `Í∏∞Ïñµ (${conversationMemory.length})`;
        }
        
        // Í∏∞Ïñµ Ìå®ÎÑê ÌÜ†Í∏Ä
        function toggleMemoryPanel() {
            const memoryPanel = document.getElementById('memory-panel');
            isMemoryPanelVisible = !isMemoryPanelVisible;
            
            memoryPanel.style.display = isMemoryPanelVisible ? 'block' : 'none';
        }
        
        // Í∏∞Ïñµ Ï¥àÍ∏∞Ìôî
        function clearMemory() {
            conversationMemory = [];
            updateMemoryDisplay();
            saveMemoryToStorage();
        }
        
        // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Í∏∞Ïñµ Ï†ÄÏû•
        function saveMemoryToStorage() {
            localStorage.setItem('brainMemory', JSON.stringify(conversationMemory));
        }
        
        // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Í∏∞Ïñµ Î°úÎìú
        function loadMemoryFromStorage() {
            const savedMemory = localStorage.getItem('brainMemory');
            if (savedMemory) {
                try {
                    const parsedMemory = JSON.parse(savedMemory);
                    
                    // ÎÇ†Ïßú Í∞ùÏ≤¥ Î≥ÄÌôò
                    parsedMemory.forEach(memory => {
                        memory.timestamp = new Date(memory.timestamp);
                    });
                    
                    conversationMemory = parsedMemory;
                    updateMemoryDisplay();
                } catch (e) {
                    console.error('Í∏∞Ïñµ Î°úÎìú Ïã§Ìå®:', e);
                }
            }
        }
        
        // Ï¥àÍ∏∞Ìôî ÏãúÏûë
        init();
    </script>
</body>
</html>
